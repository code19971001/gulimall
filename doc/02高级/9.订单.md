## 订单

> 电商系统涉及到3个流，分别对应信息流，资金流，物流。而订单环节作为中枢，需要将三者进行结合。

### 1 基本介绍

#### 1.1 订单系统的构成

![image-20210713203527461](https://blog-images-code1997.oss-cn-hangzhou.aliyuncs.com/java/project/gmall/02high/image-20210713203527461.png)

#### 1.2 订单状态转换

1、待付款

用户提交订单后，订单进行预下单，目前主流电商网站都会唤起支付，便于用户快速完成支付，待付款状态下可以对库进行锁定，锁定库存需要配置支付超时时间，超时后将自动取消订单，订单变关闭状态

2、已付款/待发货

用户完成订单支付，订单系统需要记录支付时间，支付流水单号便于对账，订单下方到wms系统，厂库进行调拨，配货、分拣、出库等。

3、待收货、已发货

仓储将商品出库之后，订单进入物流环节，订单系统需要同步物流信息，便于用户实时知悉物品的物流状态。

4、已完成

用户确认收货之后，订单交易完成，后续支付侧进行结算，如果订单存在问题，则进入售后状态。

5 、已取消

付款之前取消i当你孤单，包括超时未付款或用户商户取消订单都会产生这种订单状态。

6、售后中

用户在付款后申请退款，或者商家发货之后用户申请退换货。

当发起售后申请后生成售后订单，售后订单状态为待审核，等待商家审核，商家审核通过之后，订单状态更改为待退货，等待用户将商品寄回，商家收货后订单更改为待退款状态，退款到用户原账户后订单状态更新为售后成功。

#### 1.3 订单的流程

订单的产生和执行流程比较复杂，大概的流程如下图所示：

![image-20210713204642496](https://blog-images-code1997.oss-cn-hangzhou.aliyuncs.com/java/project/gmall/02high/image-20210713204642496.png)

### 2 实现







