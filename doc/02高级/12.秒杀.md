## 秒杀

> 秒杀具有瞬间高并发的特点，针对这些特点必须做到限流+异步+缓存(页面静态化)+独立部署。

限流方式：

1. 前端限流：一些高并发网站，直接在前端进行限流，比如小米的验证码设计。
2. nginx限流，直接负载部分请求到错误的静态页面：令牌算法，漏斗算法。
3. 网关限流，限流的过滤器。
4. 代码中使用分布式信号量。
5. Rabbitmq限流(能者多劳：chanel.basicQos(1))，保证发挥所有服务器的性能。

秒杀系统关注的问题：

- 服务单一职责+独立部署：秒杀服务即便是自己扛不住压力，也不能影响别的业务。
- 秒杀链接加密：防止恶意攻击，模拟秒杀请求，1000次/s攻击，防止链接暴露，自己的工作人员提前秒杀商品。
- 库存预热+快速扣减：秒杀读多，写少，无需每次实时校验库存，我们进行库存预热，放到redis中，使用信号量控制秒杀请求。
- 动静分离：做好动静分离，保证秒杀和商品详情页的动态请求才可以打到后端的服务集群，使用CDN网络，分担本集群的压力。
- 恶意请求的拦截：脚本来进行抢购，识别非法攻击请求并进行拦截(网关层拦截)。
- 流量错峰：使用各个手段，将流量分担到更大的宽度的时间点，比如验证码，加入购物车。
  - 例如：秒杀之后让输入验证码，既可以识别人机，也可以实现流量错峰。
- 限流&熔断&降级
  - 前端限流+后端限流，限制次数，限制总量，快速失败降级运行，熔断隔离防止雪崩。
- 队列削峰：双11所有秒杀成功的请求，进入队列，慢慢创建订单，扣减库存即可。

### 



